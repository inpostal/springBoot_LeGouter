<!DOCTYPE html>
<html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Le Goûter</title>
    <meta name="robots" content="noindex, follow"/>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="/Dessert/CSS/bootstrap.min.css">
    <!-- FontAwesome -->
    <!-- <link rel="stylesheet" href="assets/css/vendor/font.awesome.min.css"> -->
    <!-- Ionicons -->
    <link rel="stylesheet" href="/Dessert/CSS/ionicons.min.css">
    <!-- Slick CSS -->
    <link rel="stylesheet" href="/Dessert/CSS/slick.min.css">
    <!-- Animation -->
    <link rel="stylesheet" href="/Dessert/CSS/animate.min.css">
    <!-- jQuery Ui -->
    <link rel="stylesheet" href="/Dessert/CSS/jquery-ui.min.css">
    <!-- Nice Select -->
    <link rel="stylesheet" href="/Dessert/CSS/nice-select.min.css">
    <!-- Magnific Popup -->
    <link rel="stylesheet" href="/Dessert/CSS/magnific-popup.css">
    <link href="/Commom/css/all.min.css" rel="stylesheet">
    <link href="/Dessert/CSS/bootstrap1.min.css" rel="stylesheet">
    <link href="/Commom/css/owl.carousel.min.css" rel="stylesheet">
    <link href="/Commom/css/style.css" rel="stylesheet">
    <link href="/Commom/css/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/Course/CSS/stylev.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</head>

<body>


<div class="container-fluid top-bar bg-dark text-light px-0 wow fadeIn" data-wow-delay="0.1s"></div>

<!-- 頁首 -->
<div th:insert="front-end/components/Header :: #header-div"></div>
<!-- 導覽列 -->
<div th:insert="front-end/components/NavBar :: #nav-bar"></div>

<div class="eve breadcrumbs-area position-relative" style="margin-top: 0px;">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <div class="breadcrumb-content position-relative section-content">
                    <h3 class="title-3">甜點追蹤清單</h3>
                    <ul>
                        <li><a href="index.html">瀏覽甜點</a></li>
                        <li>甜點追蹤清單</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Wishlist main wrapper start -->
<div class="wishlist-main-wrapper mt-no-text mb-no-text">
    <div class="container container-default-2 custom-area">
        <div class="row">
            <div class="col-lg-12">
                <p style="display: none" th:text="${memberId}" id="member-id"></p>
                <p style="display: none" th:text="${dessertId}" id="dessert-id"></p>

                <!-- Wishlist Table Area -->
                <div class="wishlist-table table-responsive">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th class="pro-thumbnail">甜點圖片</th>
                            <th class="pro-title">甜點名稱</th>
                            <th class="pro-price">價格</th>
                            <th class="pro-cart">加入購物車</th>
                            <th class="pro-remove">移除</th>
                        </tr>
                        </thead>
                        <tbody id="wishlist">

                        <tr th:each="d : ${wishlist}">
                            <!--                            @{/employee/get/img/{id}(id=${chef.getEmpId()})}-->
                            <td class="pro-thumbnail"><a
                                    th:href="@{/dessertshop/shopAndproduct/sproduct.html(param=${d.getDessertId()})}"><img
                                    th:src="@{/dessert5/image0(dessertId=${d.getDessertId()})}"
                                    class="img-fluid"
                                    alt="Product"/></a>
                            </td>
                            <td class="pro-title"><a
                                    th:href="@{/dessertshop/shopAndproduct/sproduct.html(param=${d.getDessertId()})}"
                                    th:text="${d.getDessertName()}"></a></td>
                            <td class="pro-price"><span th:text="${d.getDessertPrice()}"></span></td>
                            <td class="pro-cart">
                                <form>
                                    <input type="hidden" th:name="dessertId" th:value="${d.getDessertId()}">
                                    <button class="btn obrien-button primary-btn text-uppercase addtocart">加入購物車
                                    </button>
                                </form>
                            </td>
                            <td class="pro-remove">
                                <form th:action="@{/removewishlist}" method="post">
                                    <input type="hidden" th:name="dessertId" th:value="${d.getDessertId()}">
                                    <button class="badge rounded-pill bg-danger remove" type="submit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-trash-fill" viewBox="0 0 16 16">
                                            <path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/>
                                        </svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Wishlist main wrapper end -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<<!-- jQuery JS -->
<!--<script src="/Dessert/JS/jquery-3.5.1.min.js"></script>-->
<!-- jQuery Migrate JS -->
<script src="/Dessert/JS/jQuery-migrate-3.3.0.min.js"></script>
<!-- Modernizer JS -->
<script src="/Dessert/JS/modernizr-2.8.3.min.js"></script>
<!-- Bootstrap JS -->
<script src="/Dessert/JS/bootstrap.bundle.min.js"></script>
<!-- Slick Slider JS -->
<!--<script src="/Dessert/JS/slick.min.js"></script>-->
<!-- Countdown JS -->
<script src="/Dessert/JS/jquery.countdown.min.js"></script>
<!-- Ajax JS -->
<!--<script src="/Dessert/JS/jquery.ajaxchimp.min.js"></script>-->
<!-- Jquery Nice Select JS -->
<script src="/Dessert/JS/jquery.nice-select.min.js"></script>
<!-- Jquery Ui JS -->
<!--<script src="/Dessert/JS/jquery-ui.min.js"></script>-->
<!-- jquery magnific popup js -->
<!--<script src="/Dessert/JS/jquery.magnific-popup.min.js"></script>-->

<!-- Main JS -->
<!--<script src="/Dessert/JS/main.js"></script>-->
<!-- 頁腳 -->
<div th:insert="front-end/components/Footer :: #footer-div"></div>
<!-- 版權所有 -->
<div th:insert="front-end/components/Copyright :: #copyright-div"></div>

<script>
    let removeButtons = document.querySelectorAll('.remove');
    removeButtons.forEach(removeButton => {
        removeButton.addEventListener('click', function (event) {
            event.preventDefault();  // 阻止表單的預設提交行為
            let dessertId = $(this).siblings('input[name="dessertId"]').val();
            let currentRow = $(this).parents('tr'); // 選擇到當前行
            console.log("dessertId:", dessertId);  // 打印出dessertId來檢查
            // 使用 AJAX 發送刪除請求
            $.ajax({
                url: '/deletewishlist',
                type: 'POST',
                data: {dessertId: dessertId},
                success: function (response) {
                    // 刪除成功後的處理邏輯
                    Swal.fire('刪除了QQ')
                    currentRow.remove(); // 移除當前行
                },
                error: function (xhr, status, error) {
                    // 刪除失敗後的處理邏輯
                    console.error('刪除失敗：', error, xhr.responseText);
                }
            });
        });
    });


    $(".addtocart").on("click", function (event) {
        event.preventDefault();  // 阻止按钮的默认提交行为
        let dessertId = $(this).siblings('input[name="dessertId"]').val();
        let currentRow = $(this).parents('tr'); // 选择到当前行

        $.ajax({
            url: '/addtocart',
            type: 'POST',
            data: {dessertId: dessertId},
            success: function (response) {
                // 加入购物车成功后的处理逻辑
                console.log('加入购物车成功！');

                // 使用SweetAlert弹出提醒
                Swal.fire(
                    '識貨喔！',
                    '快去結帳ㄅ！',
                    'success'
                );

                // 在这里调用删除追踪清单的AJAX请求
                $.ajax({
                    url: '/deletewishlist',
                    type: 'POST',
                    data: {dessertId: dessertId},
                    success: function (response) {
                        // 删除成功后的处理逻辑
                        console.log('rrr！');
                        currentRow.remove(); // 移除当前行
                    },
                    error: function (xhr, status, error) {
                        // 删除失败后的处理逻辑
                        console.error('从追踪清单中删除失败：', error, xhr.responseText);
                    }
                });
            },
            error: function (xhr, status, error) {
                // 加入购物车失败后的处理逻辑
                console.error('加入购物车失败：', error, xhr.responseText);
            }
        });
    });


</script>


</body>

</html>