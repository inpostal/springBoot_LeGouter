<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Goûter</title>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" />

    <link rel="stylesheet" href="style.css">


    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
    <link href="static/css/css2.css" rel="stylesheet">

    <link href="static/css/all.min.css" rel="stylesheet">
    <link href="static/css/bootstrap-icons.css" rel="stylesheet">

    <link href="static/css/animate.min.css" rel="stylesheet">
    <link href="static/css/owl.carousel.min.css" rel="stylesheet">

    <link href="static/css/bootstrap.min.css" rel="stylesheet">

    <link href="static/css/style.css" rel="stylesheet">
</head>
<style>
    .px-lg-5 {
        background-color: #1E1916;
    }

</style>

<body>

    <div id="spinner"
        class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
        <div class="spinner-grow text-primary" role="status"></div>
    </div>


    <div id="header-div"></div>


    <div id="nav-div"></div>

<!-- 主要內容 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------->

    <section id="prodetails" class="section-p1">

    </section>

<!-- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ -->
    <div id="footer-div"></div>
    <div id="copyright-div"></div>

<!-- ---------------------------------------------------------------------------------------------------------------------------------------- -->
    <!-- 共用頭尾 -->
    <script src="/Conponents/front_end.js"></script>

<!-- ---------------------------------------------------------------------------------------------------------------------------------------- -->
    <script data-cfasync="false" src="static/js/email-decode.min.js"></script>
    <script src="static/js/jquery-3.4.1.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/bootstrap.bundle.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/wow.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/easing.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/waypoints.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/counterup.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/owl.carousel.min.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>

    <script src="static/js/main.js" type="0080e6b992b21508d4c0eeae-text/javascript"></script>
    <script src="static/js/rocket-loader.min.js" data-cf-settings="0080e6b992b21508d4c0eeae-|49" defer=""></script>


<!-- --------------------------------------------------------------------------------------------------------------------------------------- -->


    <!-- 顯示內容 -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js" integrity="sha512-uMtXmF28A2Ab/JJO2t/vYhlaa/3ahUOgj1Zf27M5rOo8/+fcTUVH0/E0ll68njmjrLqOBjXM3V9NiPFL5ywWPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <!-- sweet alert-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="sweetalert2.all.min.js"></script>
    <!--    toast -->
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://cdn.bootcss.com/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/toastr.js/latest/js/toastr.min.js"></script>

    <script>
        toastr.options = {
            // toastr配置
            "closeButton": true, //是否显示关闭按钮
            "debug": false, //是否使用debug模式
            "progressBar": true, //是否显示进度条，当为false时候不显示；当为true时候，显示进度条，当进度条缩短到0时候，消息通知弹窗消失
            "positionClass": "toast-top-center",//显示的动画位置
            "showDuration": "400", //显示的动画时间
            "hideDuration": "1000", //消失的动画时间
            "timeOut": "7000", //展现时间
            "extendedTimeOut": "1000", //加长展示时间
            "showEasing": "swing", //显示时的动画缓冲方式
            "hideEasing": "linear", //消失时的动画缓冲方式
            "showMethod": "fadeIn", //显示时的动画方式
            "hideMethod": "fadeOut" //消失时的动画方式
        }


        $(document).ready(getAllContent());
        function getAllContent(){
            // 取得主頁傳過來的參數
            let param = new URLSearchParams(window.location.search);
            let dessertId = param.get('param');
            console.log(dessertId);

            // 生成內容
            $.ajax({
                url: '/dessert5front/getallcontent?dessertId='+ dessertId,
                type: 'GET',
                success: function(res){
                    console.log(res);
                    let html = `<div class="single-pro-image">
                                    <img src="/dessert5/image0?dessertId=${dessertId}" width="100%" id="MainImg" alt="">
                                    <div class="small-img-group">
                                        <div class="small-img-col">
                                            <img src="/dessert5/image0?dessertId=${dessertId}" width="100%" class="small-img" alt="">
                                        </div>
                                        <div class="small-img-col">
                                            <img src="/dessert5/image1?dessertId=${dessertId}" width="100%" class="small-img" alt="">
                                        </div>
                                        <div class="small-img-col">
                                            <img src="/dessert5/image2?dessertId=${dessertId}" width="100%" class="small-img" alt="">
                                        </div>
                                        <div class="small-img-col">
                                            <img src="/dessert5/image3?dessertId=${dessertId}" width="100%" class="small-img" alt="">
                                        </div>
                                    </div>
                                </div>

                                <div class="single-pro-details">
                                    <h6>甜點商城</h6>
                                    <h4>${res.dessertName}</h4>
                                    <h2>NT$${res.dessertPrice}</h2>
                                    <div><button class="normal" style="border: 2px; padding: 10px 10px 10px 0; background-color: white; color:#1E1916;" onmouseover="this.style.color='red';" onmouseout="this.style.color='#1E1916'" id="addtolovelist">加入追蹤清單</button></div>
<!--                                    <input type="number" value="1">-->
                                    <button class="normal" id="addtocart" onmouseover="this.style.background='#c90c0c';" onmouseout="this.style.background='#1E1916'">加入購物車</button>
                                    <h4>Product Details</h4>
                                    <span>
                                        ${res.dessertContent}
                                    </span>
                                </div>`;

                    $("#prodetails").html(html);

                    let MainImg = document.getElementById("MainImg");
                    let smallimg = document.getElementsByClassName("small-img");

                    smallimg[0].onclick = function () {
                        MainImg.src = smallimg[0].src;
                    }
                    smallimg[1].onclick = function () {
                        MainImg.src = smallimg[1].src;
                    }
                    smallimg[2].onclick = function () {
                        MainImg.src = smallimg[2].src;
                    }
                    smallimg[3].onclick = function () {
                        MainImg.src = smallimg[3].src;
                    }

                    // 加入購物車，並檢查登入
                    $("#addtocart").on("click", function(){
                        $.ajax({
                            url: '/dessert5front/addtocart?dessertId='+ dessertId,
                            type: 'GET',
                            success: function(res) {
                                console.log(res);
                                if (res == "/login") {
                                    // window.alert("請先登入會員，將跳轉至會員登入頁面");
                                    Swal.fire({
                                        title: '請登入會員',
                                        text: "須先登入會員才能使用購物車功能",

                                        // icon: 'warning',
                                        showCancelButton: true,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: '確定，將跳轉至登入頁面',
                                        cancelButtonText: '暫不登入'
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            window.location.href = res;
                                        }
                                    })
                                }  else if (res == "已加入購物車") {
                                    // window.alert(res);
                                    toastr.success(res);
                                } else {
                                    // window.alert(res);
                                    toastr.error(res);
                                }
                            }
                        });
                    });

                    // 加入追蹤清單，並檢查登入
                    $("#addtolovelist").on("click", function(){
                        $.ajax({
                            url: '/dessert5front/addtolovelist?dessertId='+ dessertId,
                            type: 'GET',
                            success: function(res){
                                console.log(res);
                                if (res == "/login"){
                                    // window.alert("請先登入會員，將跳轉至會員登入頁面");
                                    Swal.fire({
                                        title: '請登入會員',
                                        text: "須先登入會員才能使用追蹤清單功能",

                                        // icon: 'warning',
                                        showCancelButton: true,
                                        confirmButtonColor: '#3085d6',
                                        cancelButtonColor: '#d33',
                                        confirmButtonText: '確定，將跳轉至登入頁面',
                                        cancelButtonText: '暫不登入'
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            window.location.href = res;
                                        }
                                    })
                                } else {
                                    // window.alert(res);
                                    toastr.success(res);
                                }
                            }
                        });
                    });











                },
                error: function(xhr, textStatus, errorThrown) {
                    console.error(xhr);
                }
            })
        }
    </script>

    <script src="script.js"></script>

</body>

</html>